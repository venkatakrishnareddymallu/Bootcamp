!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.g1={})}(this,function(t){"use strict";var h={null:{null:{state:"null"},date:{state:"date"},number:{state:"number"},boolean:{state:"boolean"},string:{state:"string"},object:{state:"object"},mixed:{state:"mixed",end:!0}},date:{null:{state:"date"},undefined:{state:"date"},date:{state:"date"},default:{state:"mixed",end:!0}},number:{null:{state:"number"},undefined:{state:"number"},number:{state:"number"},default:{state:"mixed",end:!0}},boolean:{null:{state:"boolean"},undefined:{state:"boolean"},boolean:{state:"boolean"},default:{state:"mixed",end:!0}},string:{null:{state:"string"},undefined:{state:"string"},string:{state:"string"},default:{state:"mixed",end:!0}},object:{null:{state:"object"},object:{state:"object"},undefined:{state:"object"},default:{state:"mixed",end:!0}},mixed:{default:{state:"mixed",end:!0}}};function p(t,e){var a={};if(!t||!t.length)return a;(e=e||{}).convert=e.convert||!1,e.limit=e.limit||1e3;for(var n=e.limit<t.length?e.limit:t.length,o=e.ignore=e.ignore||[null,void 0],r=Object.keys(t[0]),i=0;i<r.length;i++){for(var l=r[i],s="null",d=0;d<n;d++){var c=t[d],f=c[l];if(0==i&&Object.keys(t[d]).forEach(function(t){-1==r.indexOf(t)&&r.push(t)}),l in c&&!(0<=o.indexOf(f))){var u=typeof f;null==f?u="null":"object"!=u||isNaN(Date.parse(f))?e.convert&&(!isNaN(parseFloat(f))&&isFinite(f)||0<=["NaN","Infinity","-Infinity"].indexOf(f)?u="number":isNaN(Date.parse(f))?-1!=["true","false"].indexOf(f)&&(u="boolean"):u="date"):u="date";var m=h[u],p=m[s]||m.default;if(s=p.state,p.end)break}}a[l]=s}return a}var g=["href","protocol","origin","userinfo","username","password","hostname","port","relative","pathname","directory","file","search","hash"],b=["searchKey","searchList"],i=/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,l=/(?:^|&)([^&=]*)=?([^&]*)/g,s=function(t){return decodeURIComponent(t.replace(/\+/g,"%20"))},y=encodeURIComponent;function w(t){for(var e={toString:d,join:c,update:f},a=i.exec(t||""),n=14;n--;)e[g[n]]=a[n]||"";var o=e[b[0]]={},r=e[b[1]]={};return e[g[12]].replace(l,function(t,e,a){e&&(e=s(e),a=s(a),o[e]=a,r[e]=r[e]||[],r[e].push(a))}),e}function d(t){var e,a,n,o,r=(t=t||this)[g[1]]||"http",i=t[g[4]],l=t[g[5]],s=t[g[6]],d=t[g[7]],c=t[g[9]],f=t[g[12]],u=t[g[13]],m=t[b[0]],p=t[b[1]],h=s?[r,"://"]:[],v=[];if(i&&(h.push(i),l&&h.push(":",l),h.push("@")),h.push(s),d&&h.push(":",d),h.push(c||(s?"/":"")),f)h.push("?",f);else{if(p)for(e in p){for(n=0,o=(a=p[e]).length;n<o;n++)v.push(y(e)+"="+y(a[n]));o||v.push(e)}else if(m)for(e in m)v.push(y(e)+"="+y(m[e]));v.length&&h.push("?",v.join("&"))}return u&&h.push("#",u),h.join("")}function c(t,e){e=e||{};var a,n,o=this,r=o[g[9]].split("/"),i=r.length-1,l=w(t),s=l.pathname.split("/"),d=s.length;for(void 0===e.query&&(e.query=!0),void 0===e.hash&&(e.hash=!0),a=0;a<14;a++)9!=a&&(12!=a||e.query)&&(13!=a||e.hash)&&l[g[a]]&&(o[g[a]]=l[g[a]]);for(e.query&&l[g[12]]&&(o[b[0]]=l[b[0]],o[b[1]]=l[b[1]]),a=0;a<d;a++)"."==(n=s[a])?r[i]="":".."==n?r[--i]="":""===n?1<d&&(a||(r[0]=n,i=1),a==d-1&&(r[i]=n)):(r[i]=n,a<d-1&&i++);var c=o[g[9]]=r.slice(0,i+1).join("/"),f=c.split(/\//),u=[c];return o[g[12]]&&u.push("?",o[g[12]]),o[g[13]]&&u.push("#",o[g[13]]),o[g[8]]=u.join(""),o[g[10]]=f.slice(0,f.length-1).join("/")+"/",o[g[11]]=f[f.length-1],o}function f(t,e){var a,n,o,r,i,l,s,d=this[b[0]],c=this[b[1]],f=[],u={};if(e)if((e=""+e).match(/[&=]/))u=w("?"+e).searchKey;else for(a in t)u[a]=e;for(a in t){if(null===(n=t[a]))c[a]=[];else if(Array.isArray(n)||(n=[n]),u[a]){a in c||(c[a]=[]);for(i={},o=0,r=n.length;o<r;o++)i[n[o].toString()]=1;if((e=""+u[a]).match(/add/i))c[a]=c[a].concat(n);else if(e.match(/del/i)){for(s=[],o=0,r=(l=c[a]).length;o<r;o++)i[l[o]]||s.push(l[o]);c[a]=s}else if(e.match(/toggle/i)){for(s=[],o=0,r=(l=c[a]).length;o<r;o++)i[l[o]]?i[l[o]]=2:s.push(l[o]);for(n in i)1==i[n]&&s.push(n);c[a]=s}}else c[a]=n;0===c[a].length?(delete d[a],delete c[a]):d[a]=c[a][c[a].length-1]}for(a in c)for(o=0,r=(n=c[a]).length;o<r;o++)f.push(y(a)+"="+y(n[o]));return this.search=f.join("&"),this}function e(t,e){return t.filter(e).add(t.find(e))}function x(t,e,a){var n=t.data(e);return void 0===n||!1===n||null===n?a:"string"!=typeof n||!n.match(/^(false|off|n|no)$/i)}var a={parse:w,unparse:d,join:c,update:f};function n(i,l){return function(t){var e,a,n,o="function"==typeof l.metric?l.metric:function(t){return t[l.metric]};l.scheme&&0!==(n=l.scheme).lastIndexOf("scheme",0)&&(n="interpolate"+n),a=l.scale?l.scale.replace(/\w+/g,function(t){return t[0].toUpperCase()+t.slice(1).toLowerCase()}):n?"Sequential":"Linear";var r=l.domain||d3.extent(i,o);return n?e=d3["scale"+a](d3[n]).domain(r):l.range&&(e=d3["scale"+a]().domain(r).range(l.range)),e(o(t))}}function k(t,e){if(!e)return t;var a={};for(var n in t){var o=n.split(":");1==o.length?a[o[0]]=t[n]:o[0]===e&&(a[o[1]]=t[n])}return a}function o(t,e,a){return t?-1!=t.indexOf(e)?!a:a:a?null==e:null!=e}function r(t,e,a){return isNaN(e)&&Date.parse(e)&&(e=Date.parse(e)),isNaN(t)&&Date.parse(t)&&(t=Date.parse(t)),a?t<=e:t<e}"undefined"!=typeof jQuery&&jQuery.extend(jQuery.fn,{urlfilter:function(t){t=t||{};var e=this;if(0!=e.length){var a=e[0].ownerDocument,u=t.attr||e.data("attr")||"href",n=t.event||e.data("event")||"click",o=t.selector||e.data("selector")||".urlfilter",m=t.src||e.data("src")||"src",p=t.mode||e.data("mode"),h=t.target||e.data("target"),v=t.remove||x(e,"remove"),r=t.off||x(e,"off"),g=t.location||(a.defaultView||a.parentWindow).location,b=t.history||(a.defaultView||a.parentWindow).history;return r?e.off(n+".urlfilter"):e.on(n+".urlfilter",o,function(t){t.preventDefault();var o,e=$(this),r=e.data("mode")||p,a=e.data("target")||h,n=e.data("src")||m,i=x(e,"remove",v);if("click"==t.type)o=e.attr(u);else if("submit"==t.type)o="?"+e.serialize();else if("input"==t.type||"change"==t.type){var l=encodeURIComponent(e.attr("id")||e.attr("name")),s=encodeURIComponent(e.val());o="?"+l+"="+s}var d=w(o),c=d.searchList;function f(t){var e=w(t).join(o,{query:!1,hash:!1}).update(c,r);if(i){var a={};for(var n in e.searchKey)""===e.searchKey[n]&&(a[n]=null);e.update(a)}return e.toString()}a?"#"==a?g.hash=f(g.hash.replace(/^#/,"")):a.match(/^pushstate$/i)?b.pushState({},"",f(g.href)):$(a).each(function(){var t=$(this),e=f(t.attr(n));t.attr(n,e).load(e,function(){t.trigger({type:"load",url:e})})}):g.href=f(g.href),e.trigger({type:"urlfilter",url:d})})}}});var u,v={"=":function(t,e){return o(t,e,!1)},"!":function(t,e){return o(t,e,!0)},">":function(t,e){return r(t,e,!1)},"<":function(t,e){return r(e,t,!1)},">~":function(t,e){return r(t,e,!0)},"<~":function(t,e){return r(e,t,!0)},"~":function(t,e){return o(e,t[0],!1)},"!~":function(t,e){return o(e,t[0],!0)}},j={string:function(t,e,a){return a||(a="asc"),"desc"==a&&(t=[e,e=t][0]),t.localeCompare(e)},number:function(t,e,a){return a||(a="asc"),"desc"==a&&(t=[e,e=t][0]),t-e}};function m(t,e,a){var n,o,r=t;e=k(e=e||[],a);var i=p(t,{convert:!0});for(var l in e)if("_"!=l[0]){var s=l.match(/(!|>|>~|<|<~|~|!~)$/)?l.match(/(!|>|>~|<|<~|~|!~)$/).index:l.length;n=""!=l.slice(s)?l.slice(s):"=",o=""!=e[l][0]?e[l]:null;var d=l.slice(0,s);"number"==i[d]?o=o.map(function(t){return parseFloat(t)}):"boolean"==i[d]?o=o.map(function(t){return"true"==String(t)}):"date"==i[d]&&(o=o.map(function(t){return Date.parse(t)})),r=r.filter(function(t){return void 0===t[d]||v[n](o,t[d])})}var c=parseInt(e._offset)||0,f=parseInt(e._limit)||1e3;if(r=r.slice(c,c+f),e._c){var u=[],m=[];e._c.forEach(function(t){"-"==t[0]?u.push(t.slice(1)):m.push(t)}),r=r.map(function(t){return function(e,t,a){0==t.length&&(t=Object.keys(e));var n={};return t.forEach(function(t){a.indexOf(t)<0&&(n[t]=e[t])}),n}(t,m,u)})}return e._sort&&r.sort(function(n,o){var r=!1;return e._sort.forEach(function(t){var e="-"==t[0]?"desc":"asc";if("-"==t[0]&&(t=t.substr(1)),void 0!==n[t]){var a=isNaN(n[t])?"string":"number";r=r||j[a](n[t],o[t],e)}}),r}),r}var I=180/Math.PI,E={translateX:0,translateY:0};function M(t){return null==t?E:(u||(u=document.createElementNS("http://www.w3.org/2000/svg","g")),u.setAttribute("transform",t),(t=u.transform.baseVal.consolidate())?function(t,e,a,n,o,r){var i,l,s;(i=Math.sqrt(t*t+e*e))&&(t/=i,e/=i);(s=t*a+e*n)&&(a-=t*s,n-=e*s);(l=Math.sqrt(a*a+n*n))&&(a/=l,n/=l,s/=l);t*n<e*a&&(t=-t,e=-e,s=-s,i=-i);return{translateX:o,translateY:r,rotate:Math.atan2(e,t)*I,skewX:Math.atan(s)*I,scaleX:i,scaleY:l}}((t=t.matrix).a,t.b,t.c,t.d,t.e,t.f):E)}function O(t,e,a){return e in t&&(a=t[e],delete t[e]),a}function S(t){for(var e=1,a=arguments.length;e<a;e++){var n=arguments[e];for(var o in n)t[o]=n[o]}return t}function C(t,a,e){var n=t.map(function(t,e){return e});if(a){var o=t.map("function"==typeof a?function(t,e){return[a(t),e]}:function(t,e){return[t[a],e]});n.sort(function(t,e){var a=o[t][0],n=o[e][0];return a<n?-1:n<a?1:o[t][1]-o[e][1]}),e=!e&&void 0!==e;for(var r=0,i=n.length,l=[];r<i;r++)l[n[r]]=e?r:i-r-1;n=l}return n}function q(t,e){for(var a in e)"object"==typeof e[a]&&(e[a]=n(t,e[a]));return e}var A=".sanddance",N={grid:function(t,e){var a=e.data,n=e.width,o=e.height,r=n*o/a.length,i=Math.sqrt(r),l=Math.ceil(n/i),s=Math.ceil(a.length/l),d=i*s,c=e.filter,f=C(a=c?a.filter(function(t,e){return c(t,e)}):a,e.sort,e.ascending);return t.transform=function(t,e){var a=(e=f[e])%l,n=Math.floor(e/l);return"translate("+(this.dataset._sd_x=a*i)+","+(this.dataset._sd_y=d-(n+1)*i)+")"},{attrs:q(a,t),options:e}},hexpack:function(t,e){var a,n=e.data,o=e.filter,r=C(n=o?n.filter(function(t,e){return o(t,e)}):n,e.sort,e.sort_ascending),i=n.length,l=[[0,0]],s=1,d=0;for(;d<i;){for(a=0;1-s<=a;a--)l.push([s,a]);for(a=s;1<=a;a--)l.push([a,-s]);for(a=0;1-s<=a;a--)l.push([a,-s-a]);for(a=0;a<=s-1;a++)l.push([-s,a]);for(a=-s;a<=-1;a++)l.push([a,s]);for(a=0;a<=s-1;a++)l.push([a,s-a]);d+=6*s,s++}var c=e.width,f=e.height,u=2*s-1,m=c/u,p=f/u,h=m*Math.cos(60*Math.PI/180),v=p*Math.sin(60*Math.PI/180);return l=l.slice(0,i).map(function(t){return[t[0]*m+t[1]*h+c/2,t[1]*v+f/2]}),t.transform=function(t,e){e=r[e];var a=l[e];return"translate("+a[0]+","+a[1]+")"},{attrs:q(n,t),options:e}},spiral:function(t,e){var a=e.data,n=e.filter,o=C(a=n?a.filter(function(t,e){return n(t,e)}):a,e.sort,e.sort_ascending),r=O(e,"spiral_size"),i=O(e,"spiral_angle")*Math.PI/180,l=a.map(function(t,e){return[e*r*Math.cos(e*i),e*r*Math.sin(e*i)]});return t.transform=function(t,e){return e=o[e],"translate("+l[e][0]+","+l[e][1]+")"},{attrs:q(a,t),options:e}}};function T(s,d){d=d||{};var t,c=d3.dispatch("init","start","end");d.layout&&(t=N[d.layout](s,d),s=t.attrs,d=t.options);var f=d.duration,u=d.speed,m=d.delay||0,p=d.easing||d3.easeLinear,h=d.filter,v=d.x,g=d.y,a=function(t){c.call("init",t);var e=h?t.filter(h):t,a=e.transition().ease(p);if(v||g){var o="function"==typeof v?v:function(){return v},r="function"==typeof g?g:function(){return g};a.attr("transform",function(t,e){var a=o(t,e),n=r(t,e);return"translate("+(this.dataset._sd_x=a)+","+(this.dataset._sd_y=n)+")"})}for(var n in s)a=a.attr(n,s[n]);"duration"in d?a=a.duration(f):u&&(a=a.duration(function(t){var e,a,n=M(this.getAttribute("transform")),o=n.translateX,r=n.translateY,i=this.dataset._sd_x,l=this.dataset._sd_y;return(e=i-o,a=l-r,Math.sqrt(e*e+a*a))/("function"==typeof u?u(t):u)*1e3})),m&&(a=a.delay(function(t){return"function"==typeof m?m(t):m}));var i=e.size(),l=0;a.on("start.count",function(){0===l&&c.call("start",t),l++}),a.on("end interrupt",function(){if(!(0<--i)){if(0===i)return c.call("end",t);throw new function(t,e){this.message=t,this.options=e}("sanddance: Invalid count: "+i,d)}})};return a.on=function(t,e){return c.on(t+A,e),a},a.update=function(t,e){return T(S({},s,t),S({},d,e))},a}T.chain=function(){for(var t=0,e=arguments.length-1;t<e;t++)!function(t,e){t.on("end"+A,function(){this.call(e)})}(arguments[t],arguments[t+1]);return arguments[0]};var D={selector:'[data-toggle="highlight"]',target:".highlight-target",mode:"hover",attr:".data-classes",classes:"active"};"undefined"!=typeof jQuery&&jQuery.extend(jQuery.fn,{highlight:function(t){return this.each(function(){var n=$.extend({},D,t,this.dataset),o=this;e($(this),n.selector).each(function(){var e=$.extend({},n,this.dataset),a=$(this).off(".g1.highlight"),t="click"==e.mode?"click.g1.highlight":"mouseenter.g1.highlight mouseleave.g1.highlight";a.on(t,function(){var t=$(e.target,o).toggleClass(e.classes);a.trigger({type:"highlight",target:t})})})}),this}});var z="template.render",Q="template.target";function F(o,t,e,r){var i,l=_.template(t);function a(t,e){i=$($.parseHTML(l(t)));var a=e?e.target:r.target;if(void 0!==a)$(a).html(i);else{var n=o.data(Q);n&&n.remove(),o.after(i).data(Q,i)}return o.trigger({type:"template",templatedata:t,target:i}),i}return r||(r={}),o.data(z,a),a(e)}"undefined"!=typeof jQuery&&jQuery.extend(jQuery.fn,{template:function(n,o){return e(this,this.data("selector")||'script[type="text/html"]').each(function(){var e=$(this),t=e.data(z);if(t)t(n,o);else{var a=e.attr("src");a?$.get(a).done(function(t){F(e,t,n,o)}).fail(function(t){F(e,e.html(),_.extend({xhr:t},n,o))}):F(e,e.html(),n,o)}}),this}});var J=Object.freeze({template_:'<div class="position-relative"><div class="formhandler"><div class="note"></div><div class="formhandler-table-header d-flex justify-content-between mb-2"><div class="d-flex flex-wrap"><div class="edit"></div><div class="add"></div><div class="count"></div><div class="page"></div><div class="size"></div></div><div class="d-flex"><div class="filters"></div><div class="export"></div></div></div><div class="<%- (options.table == \'grid\') ? \'table_grid\' : \'table table-responsive\' %>"></div></div><div class="loader pos-cc d-none"><div class="fa fa-spinner fa-spin fa-3x fa-fw"></div><span class="sr-only">Loading...</span></div></div><div class="modal formhandler-table-modal" id="fh-modal-<%- idcount %>" tabindex="-1" role="dialog" aria-labelledby="fh-label-<%- idcount %>" aria-hidden="true"><div class="modal-dialog modal-sm" role="document"><div class="modal-content"><form class="formhandler-table-modal-form modal-body"><label id="fh-label-<%- idcount %>" for="formhandler-table-modal-value">Value</label><p><input class="form-control" name="filter_input"></p><div><button type="button" class="btn btn-sm btn-secondary mr-1" data-dismiss="modal">Cancel</button><button type="submit" class="btn btn-sm btn-primary mr-1">Apply filter</button><a class="btn btn-sm btn-danger remove-action urlfilter" data-dismiss="modal" data-target="#" href="#">Remove filter</a></div></form></div></div></div>',template_table:'<%\n  var filtered_cols = args[\'_c\'] && args[\'_c\'].length != options.columns.length ?\n                      options.columns.filter(function(col) { return args[\'_c\'].indexOf(\'-\' + col.name) < 0 }) :\n                      options.columns\n  var cols = options.columns.length ? filtered_cols : meta.columns;\n  cols = cols.filter(function(col) { return col.hide !== true})\n  var form_id = idcount\n%> <table class="table table-sm table-striped"><thead> <% _.each(cols, function(colinfo) {\n        col_defaults(colinfo, data)\n        var menu_item = false\n        var col_id = idcount++\n      %> <th class="<%- args[\'_sort\'] == colinfo.name ? \'table-primary\' : args[\'_sort\'] == \'-\' + colinfo.name ? \'table-danger\' : \'\' %>" data-col="<%- colinfo.name %>"><div class="dropdown"><a href="#" class="dropdown-toggle text-nowrap" id="fh-dd-<%- col_id %>" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"> <%- colinfo.title || colinfo.name %> </a><div class="dropdown-menu" aria-labelledby="fh-dd-<%- col_id %>"> <% _.each(colinfo.sort, function(title, op) { menu_item = true\n              var active = args[\'_sort\'] == op + colinfo.name %> <a class="dropdown-item urlfilter <%- active ? \'active\': \'\' %>" href="?_sort=<%- active ? \'\' : op + colinfo.name %>"> <%- title %> </a> <% }) %> <% if (menu_item) { %> <div class="dropdown-divider"></div> <% menu_item = false\n            } %> <% _.each(colinfo.filters, function(title, op) { menu_item = true %> <a class="dropdown-item <%= colinfo.name + op in args ? \'active\' : \'\' %>" href="#" data-op="<%- op %>" data-toggle="modal" data-target="#fh-modal-<%- form_id %>"> <%- title %> </a> <% }) %> <% if (menu_item) {\n              menu_item = false %> <div class="dropdown-divider"></div> <% } %> <% if (colinfo.hideable) { %> <a class="dropdown-item urlfilter" href="?_c=-<%- colinfo.name %>" data-mode="add">Hide</a> <% } %> </div></div></th> <% }) %> </thead><tbody> <% if (isAdd) { %> <tr class="new-row"> <% _.each(cols, function(colinfo) {\n          if (!colinfo.template) { %> <td><input class="form-control form-control-sm" data-key="<%- colinfo.name %>" value=""></td> <% } else { %> <td></td> <% } %> <% }) %> </tr> <% } %> <% if (options.rowTemplate) { %> <% _.each(data, function(row, rowIndex) { %> <%= typeof options.rowTemplate == \'function\' ? options.rowTemplate({row: row, data: data, index: rowIndex}) : _.template(options.rowTemplate)({row: row, data: data, index: rowIndex}) %> <% }) %> <% } else {%> <% _.each(data, function(row, rowIndex) { %> <tr data-val="<%- JSON.stringify(row) %>" data-row="<%- rowIndex %>"> <% _.each(cols, function(colinfo) { %> <% var fmt = typeof(colinfo.format),\n            val = row[colinfo.name],\n            isEditable = colinfo.editable === undefined ? true : colinfo.editable,\n            disp = fmt == "function" ?\n              colinfo.format({name: colinfo.name, value: val, index: rowIndex, row: row, data:data }) :\n            fmt === "string" && colinfo.type === "number" ?\n              numeral(val).format(colinfo.format) :\n            fmt === "string" && colinfo.type === "date" ?\n              moment(val).format(colinfo.format):\n              val,\n            col_link\n          %> <% if (!isEdit && \'link\' in colinfo)  var col_link = typeof colinfo.link == \'function\' ? colinfo.link({name: colinfo.name, value: val, format: disp, index: rowIndex, row: row, data: data}) : _.template(colinfo.link)({name: colinfo.name, value: val, format: disp, index: rowIndex, row: row, data: data}) %> <% if (colinfo.template) { %> <%= typeof colinfo.template == \'function\' ? colinfo.template({name: colinfo.name, value: val, format: disp, link: col_link, index: rowIndex, row: row, data: data}) : _.template(colinfo.template)(({name: colinfo.name, value: val, format: disp, link: col_link, index: rowIndex, row: row, data: data})) %> <% } else if (col_link) { %> <td><a href="<%- col_link %>" target="_blank"> <%= disp %> </a></td> <% } else { %> <% if (isEdit && isEditable) { %> <td><input class="form-control form-control-sm" data-key="<%- colinfo.name %>" value="<%- val %>"></td> <% } else { %> <td><a class="urlfilter" href="?<%- colinfo.name %>=<%- val %>&_offset="> <%= disp %> </a></td> <% } %> <% } %> <% }) %> </tr> <% }) %> <% } %> </tbody></table>',template_page:'<% var page = 1 + Math.floor(meta.offset / meta.limit),\n      last_page = \'count\' in meta ? Math.floor((meta.count + meta.limit - 1) / meta.limit) : meta.rows < meta.limit ? page : null,\n      lo = Math.max(page - 2, 1),\n      hi = last_page !== null ? Math.min(last_page, page + 2) : page + 2 %> <ul class="pagination pagination-sm mr-2"><li class="page-item <%- page <= 1 ? \'disabled\' : \'\' %>"><a class="page-link" href="?_offset=<%- meta.offset - meta.limit %>">Previous</a></li> <% if (lo > 1) { %> <li class="page-item"><a class="page-link" href="?_offset=">1</a></li> <% if (lo > 2) { %> <li class="page-item disabled"><a class="page-link" href="#">...</a></li> <% } %> <% } %> <% _.each(_.range(lo, hi + 1), function(pg) { %> <li class="page-item <%- pg == page ? \'active\' : \'\' %>"><a class="page-link" href="?_offset=<%- meta.limit * (pg - 1) || \'\' %>"> <%- pg %> </a></li> <% }) %> <% if (\'count\' in meta) { %> <% if (hi + 1 < last_page) { %> <li class="page-item disabled"><a class="page-link" href="#">...</a></li> <% } %> <% if (hi < last_page || lo > hi) { %> <li class="page-item"><a class="page-link" href="?_offset=<%- meta.limit * (last_page - 1) %>"> <%- last_page %> </a></li> <% } %> <% } %> <li class="page-item <%- (last_page === null) || (page < last_page) ? \'\' : \'disabled\' %>"><a class="page-link" href="?_offset=<%- meta.offset + meta.limit %>">Next</a></li></ul>',template_size:'<% if (meta.limit) { %> <div class="btn-group btn-group-sm mr-2" role="group"><button id="formhandler-size-<%- idcount++ %>" type="button" class="btn btn-light btn-sm dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"> <%- meta.limit %> rows</button><div class="dropdown-menu" aria-labelledby="formhandler-size-<%- idcount %>"> <% _.each(options.sizeValues, function(size) { %> <a class="dropdown-item <%- meta.limit == size ? \'active\' : \'\' %> urlfilter" href="?_limit=<%- size %>"> <%- size %> </a> <% }) %> </div></div> <% } %>',template_count:"<% if ('count' in meta) { %> <span class=\"btn btn-sm btn-light mr-2\"> <%- meta.count %> rows</span> <% } %>",template_edit:'<button type="button" class="btn btn-success mr-2 btn-sm edit-btn">Edit</button>',template_add:'<button type="button" class="btn btn-success mr-2 btn-sm add-btn">Add</button>',template_export:'<div class="btn-group btn-group-sm" role="group"><button id="formhandler-export-<%- idcount++ %>" type="button" class="btn btn-light btn-sm dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Export as</button><div class="dropdown-menu dropdown-menu-right" aria-labelledby="formhandler-export-<%- idcount %>"> <% _.each(options.exportFormats, function(label, key) { %> <a class="dropdown-item" href="<%- parse(options.src).update(args).update({_format: key}) %>"> <%- label %> </a> <% }) %> </div></div>',template_filters:'<div class="p-1"><%\n  var qparts = parse(\'?\')\n  _.each(args[\'_c\'], function(col_name) {\n    qparts.update({_c: col_name}, \'add\')\n    var hide_col = col_name[0] == \'-\'\n    var display_name = hide_col ? col_name.slice(1) : col_name %> <a href="?_c=<%- col_name %>" data-mode="del" class="badge badge-pill <%- hide_col ? \'badge-dark\' : \'badge-danger\' %> urlfilter" title="<%- hide_col ? \'Show\' : \'Hide\' %> column <%- display_name %>"> <%- display_name %> </a> <% })\n  _.each(args, function(list_values, key) {\n    if (key.charAt(0) !== \'_\' && key !== \'c\') {\n      _.each(args[key], function(col_name) {\n        var update = {}\n        update[key] = col_name\n        qparts.update(update) %> <a href="?<%- key %>=<%- col_name %>" data-mode="del" class="badge badge-pill badge-dark urlfilter" title="Clear <%- key %> filter"> <%- key %> = <%- col_name %> </a> <% })\n    }\n  })\n  qparts = qparts.toString()\n  if (qparts && qparts != \'?\') { %> <a href="?<%- qparts.slice(1) %>" class="badge badge-pill badge-danger urlfilter" data-mode="del" title="Clear all filters">×</a> <% } %> </div>',template_error:'<div class="alert alert-warning alert-dismissible" role="alert"> <%- message %> <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">×</span></button></div>',template_table_grid:'<%\n  var filtered_cols = args[\'_c\'] && args[\'_c\'].length != options.columns.length ?\n                      options.columns.filter(function(col) { return args[\'_c\'].indexOf(\'-\' + col.name) < 0 }) :\n                      options.columns\n  var cols = options.columns.length ? filtered_cols : meta.columns\n  var form_id = idcount, img\n  if (options.rowTemplate) {\n    _.each(data, function(row, rowIndex) { %> <%= typeof options.rowTemplate == \'function\' ? options.rowTemplate({row: row, index: rowIndex, data: data}) : _.template(options.rowTemplate)({row: row, data: data, index: rowIndex}) %> <% })\n} else { %> <div class="formhandler-grid row"> <% _.each(data, function(row, rowIndex) { %> <div class="col-sm-3 <%= options.classes || \'formhandler-grid-cell d-inline-block p-3 box-shadow\' %>"><div class="thumbnail"> <% img = options.icon ? ((typeof(options.icon) == \'function\' ? options.icon({row: row, data: data, index: rowIndex}) : options.icon)) : \'fa fa-home\' %> <% if (img.indexOf(\'fa \') >= 0) { %> <i class="<%= img %>"></i> <% } else { %> <img class="img img-responsive" src="<%= img %>"> <% } %> <div class="caption"> <% _.each(cols, function(colinfo) {\n              var fmt = typeof(colinfo.format),\n                  val = row[colinfo.name],\n                  disp = (fmt == "function" ? colinfo.format({index: rowIndex, name: colinfo.name, value: val, row: row, data:data }) :\n                          fmt === "string" && colinfo.type === "number" ? numeral(val).format(colinfo.format) :\n                          fmt === "string" && colinfo.type === "date" ? moment(val).format(colinfo.format) :\n                          val) %> <div><strong><%= colinfo.name %></strong>: <% if (\'link\' in colinfo) {\n                    var col_link = typeof colinfo.link == \'function\' ? colinfo.link({row: row, value: val, index: rowIndex, name: colinfo.name, data: data, format: disp}) : _.template(colinfo.link)({row: row, value: val, index: rowIndex, name: colinfo.name, data: data, format: disp}) %> <a href="<%- col_link %>" target="_blank"><%= disp %></a> <% } else { %> <a class="urlfilter" href="?<%- colinfo.name %>=<%- val %>&_offset="> <%= disp %> </a> <% } %> </div> <% }) %> </div></div></div> <% }) %> </div> <% } %>'}),P=["","table","edit","add","page","size","count","export","filters","error","table_grid"],R={table:!0,edit:!1,add:!1,page:!0,pageSize:100,size:!0,sizeValues:[10,20,50,100,500,1e3],count:!0,export:!0,exportFormats:{xlsx:"Excel",csv:"CSV",json:"JSON",html:"HTML"},filters:!0},V=["filters","ignored","excluded","sort","offset","limit","count"],U={text:{"":"Equals...","!":"Does not equal...","~":"Contains...","!~":"Does not contain..."},number:{"":"Equals...","!":"Does not equal...","<":"Less than...",">":"Greater than..."},date:{"":"Equals...","!":"Does not equal...","<":"Before...",">":"After..."}};function H(t){"sort"in t&&!0!==t.sort?"object"!=typeof t.sort&&(t.sort={}):t.sort={"":"Sort ascending","-":"Sort descending"},t.type=t.type||"text","filters"in t&&!0!==t.filters||(t.filters=U[t.type]),"hideable"in t||(t.hideable=!0),"hide"in t||(t.hide=!1)}function K(t,e,a,n,o){if(!t||a[t]){var r;if(t){"grid"==a[t]&&(t="table_grid");var i=a[t+"Target"]||"."+t;0==(r=$(i,n)).length&&(r=$(i))}else r=n;r.html(o[t](e))}}function X(t,e,a,n,o){var r=n+": "+o;0==a.readyState&&(r+=" (cannot connect to server)"),$(".note",t).html(e.error({message:r}))}function G(t,e){$("tbody input",t).on("change",function(){$(this).parents("tr").addClass("dirty-row")}).on("keypress",function(t){13==t.keyCode&&($(this).blur(),e.trigger("click"))}).eq(0).focus()}String.prototype.remove_quotes=function(){return this.toString().replace(/["']/g,"")},"undefined"!=typeof jQuery&&jQuery.extend(jQuery.fn,{formhandler:function(e){return e||(e={}),this.each(function(){var p=$(this);p.urlfilter({selector:".urlfilter, .page-link",target:"#",remove:!0});var h=$.extend({},R,e,p.data());h.columns?"string"==typeof h.columns&&(h.columns=_.map(h.columns.split(/\s*,\s*/),function(t){return{name:t}})):h.columns=[];var i,o,r,l,s,v={};function d(t,e,a){a.rows=t.length,a.columns=t.length?_.map(t[0],function(t,e){return{name:e}}):[];var n=_.find(h.columns,function(t){return"*"===t.name});if(n){var o=_.cloneDeep(a.columns);_.map(h.columns,function(e){_.find(a.columns,function(t){return t.name===e.name})||"*"===e.name||o.push(e)}),o=_.map(o,function(e){var t=_.find(h.columns,function(t){return t.name===e.name});return t||$.extend({},n,e)})}h.columns=o||h.columns;var r,i,l,s,d,c,f,u,m={data:t,meta:a,args:e,options:h,idcount:0,parse:w,col_defaults:H,isEdit:!1,isAdd:!1};p.data("formhandler",m),_.each(P,function(t){K(t,m,h,p,v)}),h.add&&(r=p,i=m,l=h,s=v,$(".add button",r).on("click",function(){var t=$(".add button",r);if("save"==t.html().toLowerCase()){t.html("Add");var e=$(".new-row input[data-key]");$(".loader",r).removeClass("d-none");var a={};$.each(e,function(t,e){a[e.getAttribute("data-key")]=e.value}),$.ajax(l.src,{method:"POST",dataType:"json",data:a}).done(function(){i.data.unshift(a),i.isAdd=!1,K("table",i,l,r,s),l.add.done&&l.add.done()}).always(function(){$(".loader",r).addClass("d-none")}).fail(X.bind(this,r,s))}else"add"==t.html().toLowerCase()&&(t.html("Save"),i.isAdd=!0,K("table",i,l,r,s),G(r,t))})),h.edit&&(d=p,c=m,f=h,u=v,$(".edit button",d).on("click",function(){var t=$(".edit button",d);if("save"==t.html().toLowerCase()){t.html("Edit");var e=$(".dirty-row");0<e.length&&$(".loader",d).removeClass("d-none");var r=[];$.each(e,function(t,e){var a=JSON.parse(e.getAttribute("data-val")),n=e.getAttribute("data-row");for(t in a){var o=$("td input[data-key="+t.remove_quotes()+"]",$(e));a[t]=c.data[n][t]=o.val()}r.push($.ajax(f.src,{method:"PUT",dataType:"json",data:a}).fail(X.bind(this,d,u)).always(function(){$(".loader",d).addClass("d-none"),f.add.editFunction&&f.add.editFunction()}))}),$.when.apply($,r).then(function(){$(".loader",d).addClass("d-none"),f.edit.done&&f.edit.done()}),c.isEdit=!1,K("table",c,f,d,u)}else"edit"==t.html().toLowerCase()&&(t.html("Save"),c.isEdit=!0,K("table",c,f,d,u),G(d,t))}))}function t(){var t=w(location.hash.replace(/^#/,"")).searchList;t=k(t,h.name);var r=_.extend({c:h.columns.map(function(t){return t.name}),_limit:h.pageSize,_format:"json",_meta:"y"},t);function e(t,e,a){var n={};if(_.each(V,function(t){var e=a?a.getResponseHeader("Fh-Data-"+t):null;null!==e&&(n[t]=JSON.parse(e))}),"function"==typeof h.transform){var o=h.transform({data:t,meta:n,options:h,args:r})||{};t="data"in o?o.data:t,n="meta"in o?o.meta:n}_.isEmpty(n)&&h.page&&h.size&&(n.offset=r._offset?parseInt(r._offset):0,n.limit=parseInt(r._limit),n.count=t.length,t=m(t,r)),d(t,r,n),p.trigger({type:"load",formdata:t,meta:n,args:r,options:h})}$(".loader",p).removeClass("d-none"),h.data&&"object"==typeof h.data?(h.edit=!1,h.add=!1,e(h.data)):$.ajax(h.src,{dataType:"json",data:r,traditional:!0}).done(e).always(function(){$(".loader",p).addClass("d-none")}).fail(X.bind(this,p,v))}_.each(P,function(t){var e=h[t?t+"Template":"template"]||J["template_"+t]||"NA";v[t]=_.template(e)}),(i=p).on("shown.bs.modal",".formhandler-table-modal",function(t){var e=$(t.relatedTarget),a=i.data("formhandler"),n=e.data("op"),o=e.closest("[data-col]").data("col"),r="";a.args[o+n]?(r=a.args[o+n].join(","),$(".remove-action",this).attr("href","?"+o+n+"=").show()):$(".remove-action",this).hide(),$("input",this).val(r).attr("name",o+n).focus(),$("label",this).text(e.text())}).on("submit","form",function(t){t.preventDefault();var e=w("?"+$(this).serialize()).searchKey;$(this).closest(".formhandler-table-modal").modal("hide"),window.location.hash="#"+w(location.hash.replace(/^#/,"")).update(e)}),r=h,l=v,s={delete:function(t){return $.ajax(r.src,{method:"DELETE",dataType:"json",data:t.row}).done(function(){$('tr[data-row="'+t.index+'"]',o).remove()})}},(o=p).on("click","[data-action]",function(){var t={row:$(this).closest("[data-val]").data("val"),index:$(this).closest("[data-row]").data("row"),notify:function(t){$(".note",o).html(l.error({message:t}))}},e=$(this).data("action"),a=r.actions&&0<r.actions.filter(function(t){return e in t}).length?r.actions.filter(function(t){return e in t})[0][e]:s[e],n=a(t);n&&n.always&&($(".loader",o).removeClass("d-none"),n.always(function(){$(".loader",o).addClass("d-none")}).fail(X.bind(this,o,l)))}),$(window).on("hashchange",t),t()}),this}});var Y="<% var urlfilterClass = key ? 'urlfilter' : '',\nmultiple = multiple ? 'multiple' : '',\nkey = key ? key : '' %> <select class=\"selectpicker border <%- urlfilterClass %>\" id=\"<%- key %>\" <%-multiple%>></select>",W='<% _.each(data, function(item) { %> <option value="<%- item %>"><%- item %></option> <% }) %>',B='<div class="alert alert-warning" role="alert"><p class="text-center"> <%- message %> </p></div>',Z=function(t){return!(!(n=t)||"object"!=typeof n||(e=t,"[object RegExp]"===(a=Object.prototype.toString.call(e))||"[object Date]"===a||e.$$typeof===tt));var e,a,n};var tt="function"==typeof Symbol&&Symbol.for?Symbol.for("react.element"):60103;function et(t,e){return!1!==e.clone&&e.isMergeableObject(t)?nt((a=t,Array.isArray(a)?[]:{}),t,e):t;var a}function at(t,e,a){return t.concat(e).map(function(t){return et(t,a)})}function nt(t,e,a){(a=a||{}).arrayMerge=a.arrayMerge||at,a.isMergeableObject=a.isMergeableObject||Z;var n,o,r,i,l=Array.isArray(e);return l===Array.isArray(t)?l?a.arrayMerge(t,e,a):(n=t,o=e,i={},(r=a).isMergeableObject(n)&&Object.keys(n).forEach(function(t){i[t]=et(n[t],r)}),Object.keys(o).forEach(function(t){r.isMergeableObject(o[t])&&n[t]?i[t]=nt(n[t],o[t],r):i[t]=et(o[t],r)}),i):et(e,a)}nt.all=function(t,a){if(!Array.isArray(t))throw new Error("first argument should be an array");return t.reduce(function(t,e){return nt(t,e,a)},{})};var ot,rt=nt,it={target:"",multiple:!1};"undefined"!=typeof jQuery&&jQuery.extend(jQuery.fn,{dropdown:function(t){var n=$(this),e=rt(it,t);function a(t){e.data=t,e.key&&n.urlfilter({selector:"select.urlfilter",target:e.target,event:"change",remove:!0}),n.find(".selectpicker").html(_.template(W)(e)),n.find(".selectpicker").selectpicker(e.options)}return n.html(_.template(Y)(e)),e.data?(a(e.data),n.trigger({type:"load"})):e.url&&(a(["Loading..."]),$.ajax(e.url).fail(function(t,e,a){n.html(_.template(B)({message:a}))}).done(function(t){a(t),n.find(".selectpicker").selectpicker("refresh"),n.trigger({type:"load"})})),this}});try{new Event("click"),ot=function(t,e){return new Event(t,e)}}catch(t){ot=function(t,e){var a=document.createEvent("event");return a.initEvent(t,e.bubbles,e.cancelable),a}}"undefined"!=typeof jQuery&&jQuery.extend(jQuery.fn,{dispatch:function(t,e){return this.each(function(){this.dispatchEvent(ot(t,$.extend({bubbles:!0,cancelable:!0},e)))})}}),"undefined"!=typeof L&&(L.TopoJSON=L.GeoJSON.extend({addData:function(t){if("Topology"===t.type)for(var e in t.objects)L.GeoJSON.prototype.addData.call(this,topojson.feature(t,t.objects[e]));else L.GeoJSON.prototype.addData.call(this,t)}})),t.version="0.9.1",t.types=p,t.url=a,t.scale=n,t.datafilter=m,t.sanddance=T,Object.defineProperty(t,"__esModule",{value:!0})});
