!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.g1=e.g1||{})}(this,function(e){"use strict";var g=Object.freeze({template_:'<div class="position-relative"><div class="formhandler"><div class="note"></div><div class="formhandler-table-header d-flex justify-content-between mb-2"><div class="d-flex flex-wrap"><div class="edit"></div><div class="add"></div><div class="count"></div><div class="page"></div><div class="size"></div></div><div class="d-flex"><div class="filters"></div><div class="export"></div></div></div><div class="<%- (options.table == \'grid\') ? \'table_grid\' : \'table\' %>"></div></div><div class="loader pos-cc d-none"><div class="fa fa-spinner fa-spin fa-3x fa-fw"></div><span class="sr-only">Loading...</span></div></div><div class="modal formhandler-table-modal" id="fh-modal-<%- idcount %>" tabindex="-1" role="dialog" aria-labelledby="fh-label-<%- idcount %>" aria-hidden="true"><div class="modal-dialog modal-sm" role="document"><div class="modal-content"><form class="formhandler-table-modal-form modal-body"><label id="fh-label-<%- idcount %>" for="formhandler-table-modal-value">Value</label><p><input class="form-control" name="filter_input"></p><div><button type="button" class="btn btn-sm btn-secondary mr-1" data-dismiss="modal">Cancel</button><button type="submit" class="btn btn-sm btn-primary mr-1">Apply filter</button><a class="btn btn-sm btn-danger remove-action urlfilter" data-dismiss="modal" data-target="#" href="#">Remove filter</a></div></form></div></div></div>',template_table:'<%\n  var filtered_cols = args[\'_c\'] && args[\'_c\'].length != options.columns.length ?\n                      options.columns.filter(function(col) { return args[\'_c\'].indexOf(\'-\' + col.name) < 0 }) :\n                      options.columns\n  var cols = options.columns.length ? filtered_cols : meta.columns;\n  cols = cols.filter(function(col) { return col.hide !== true})\n  var form_id = idcount\n%> <table class="table table-sm table-striped"><thead> <% _.each(cols, function(colinfo) {\n        col_defaults(colinfo, data)\n        var menu_item = false\n        var col_id = idcount++\n        var qsort = parse(\'?\')\n        var isSorted = _.includes(args[\'_sort\'], colinfo.name) ? {op: \'\', cls: \'table-primary\'} : _.includes(args[\'_sort\'], \'-\' + colinfo.name) ? {op: \'-\', cls: \'table-danger\'} : {}\n      %> <th class="<%- isSorted.cls %>" data-col="<%- colinfo.name %>"><div class="dropdown"><a href="#" class="dropdown-toggle text-nowrap" id="fh-dd-<%- col_id %>" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"> <%- colinfo.title || colinfo.name %> </a><div class="dropdown-menu" aria-labelledby="fh-dd-<%- col_id %>"> <% _.each(colinfo.sort, function(title, op) { menu_item = true\n              qsort = qsort.update({_sort: args[\'_sort\'] || []})\n              if (!_.isEmpty(isSorted))\n                qsort = qsort.update({_sort: [colinfo.name, \'-\' + colinfo.name]}, \'del\')\n              var active = _.includes(args[\'_sort\'], op + colinfo.name) %> <a class="dropdown-item urlfilter <%- active ? \'active\': \'\' %>" href="<%- qsort.update({_sort: [op + colinfo.name]}, active ? \'del\': \'add\').toString() %>"> <%- title %> </a> <% }) %> <% if (menu_item) { %> <div class="dropdown-divider"></div> <% menu_item = false } %> <% _.each(colinfo.filters, function(title, op) { menu_item = true %> <a class="dropdown-item <%= colinfo.name + op in args ? \'active\' : \'\' %>" href="#" data-op="<%- op %>" data-toggle="modal" data-target="#fh-modal-<%- form_id %>"> <%- title %> </a> <% }) %> <% if (menu_item) {\n              menu_item = false %> <div class="dropdown-divider"></div> <% } %> <% if (colinfo.hideable) { %> <a class="dropdown-item urlfilter" href="?_c=-<%- encodeURIComponent(colinfo.name) %>" data-mode="add">Hide</a> <% } %> </div></div></th> <% }) %> </thead><tbody> <% if (isAdd) { %> <tr class="new-row"> <% _.each(cols, function(colinfo) {\n          if (!colinfo.template) { %> <td data-key="<%- colinfo.name %>"> <% var isEditable = colinfo.editable === undefined ? true : colinfo.editable %> <%= _.template(templates[\'template_editable\'])({isEditable: isEditable, val: undefined}) %> </td> <% } else { %> <td></td> <% } %> <% }) %> </tr> <% } %> <% if (options.rowTemplate) { %> <% _.each(data, function(row, rowIndex) { %> <%= typeof options.rowTemplate == \'function\' ? options.rowTemplate({row: row, data: data, index: rowIndex}) : _.template(options.rowTemplate)({row: row, data: data, index: rowIndex}) %> <% }) %> <% } else {%> <% _.each(data, function(row, rowIndex) { %> <tr data-val="<%- JSON.stringify(row) %>" data-row="<%- rowIndex %>"> <% _.each(cols, function(colinfo) { %> <% var fmt = typeof(colinfo.format),\n            val = row[colinfo.name],\n            isEditable = colinfo.editable === undefined ? true : colinfo.editable,\n            disp = fmt == "function" ?\n              colinfo.format({name: colinfo.name, value: val, index: rowIndex, row: row, data:data }) :\n            fmt === "string" && colinfo.type === "number" ?\n              numeral(val).format(colinfo.format) :\n            fmt === "string" && colinfo.type === "date" ?\n              moment.utc(val).format(colinfo.format):\n              val,\n            col_link\n          %> <% if (!isEdit && colinfo.template) { %> <%= typeof colinfo.template == \'function\' ?\n              colinfo.template({name: colinfo.name, value: val, format: disp, link: col_link, index: rowIndex, row: row, data: data}) :\n              _.template(colinfo.template)(({name: colinfo.name, value: val, format: disp, link: col_link, index: rowIndex, row: row, data: data})) %> <% } else if (!isEdit && \'link\' in colinfo) { %> <% col_link = typeof colinfo.link == \'function\' ?\n              colinfo.link({name: colinfo.name, value: val, format: disp, index: rowIndex, row: row, data: data}) :\n              (typeof colinfo.link == \'string\' ?\n                _.template(colinfo.link)({name: colinfo.name, value: val, format: disp, index: rowIndex, row: row, data: data})\n                : colinfo.link)\n                %> <% if (col_link === false) { %> <td><%= disp %></td> <% } else if (col_link && col_link[0] == \'?\') { %> <td><a class="urlfilter" href="<%- col_link %>"><%= disp %></a></td> <% } else { %> <td><a href="<%- col_link %>" target="_blank"><%= disp %></a></td> <% } %> <% } else if (isEdit && isEditable) { %> <td data-key="<%- colinfo.name %>"> <%= _.template(templates[\'template_editable\'])({isEditable: isEditable, val: val}) %> </td> <% } else { %> <td><a class="urlfilter" href="?<%- encodeURIComponent(colinfo.name) %>=<%- encodeURIComponent(val) %>&_offset="> <%= disp %> </a></td> <% } %> <% }) %> </tr> <% }) %> <% } %> </tbody></table>',template_editable:'<% if (isEditable.input == \'select\') { %> <select <% for (key in isEditable.attrs) { %> <%= key + \'="\' + isEditable.attrs[key] + \'"\' %> <% } %> class="form-control form-control-sm"><option value="" disabled selected>-- select --</option> <% _.each(isEditable.options, function(item) { %> <option <%- val !== undefined && val === item ? \'selected\': null %> value="<%- item %>"> <%- item %> </option> <% }) %> </select> <% } else if (isEditable.input == \'radio\') { %> <% _.each(isEditable.options, function(item) { %> <input type="radio" <%- val !== undefined && val === item ? \'checked\': null %> value="<%- item %>" <% for (key in isEditable.attrs) { %> <%= key + \'="\' + isEditable.attrs[key] + \'"\' %> <% } %> class="form-control form-control-sm"> <%- item %> <br> <% }) %> <% } else { %> <input type="<%- isEditable.input || \'text\' %>" value="<%- val %>" <% for (key in isEditable.attrs) { %> <%= key + \'="\' + isEditable.attrs[key] + \'"\' %> <% } %> class="form-control form-control-sm"> <% } %> <% if (isEditable.validationMessage) { %> <div class="invalid-feedback"> <%- isEditable.validationMessage %> </div> <% } %>',template_page:'<% var page = 1 + Math.floor(meta.offset / meta.limit),\n      last_page = \'count\' in meta ? Math.floor((meta.count + meta.limit - 1) / meta.limit) : meta.rows < meta.limit ? page : null,\n      lo = Math.max(page - 2, 1),\n      hi = last_page !== null ? Math.min(last_page, page + 2) : page + 2 %> <ul class="pagination pagination-sm mr-2"><li class="page-item <%- page <= 1 ? \'disabled\' : \'\' %>"><a class="page-link" href="?_offset=<%- meta.offset - meta.limit %>">Previous</a></li> <% if (lo > 1) { %> <li class="page-item"><a class="page-link" href="?_offset=">1</a></li> <% if (lo > 2) { %> <li class="page-item disabled"><a class="page-link" href="#">...</a></li> <% } %> <% } %> <% _.each(_.range(lo, hi + 1), function(pg) { %> <li class="page-item <%- pg == page ? \'active\' : \'\' %>"><a class="page-link" href="?_offset=<%- meta.limit * (pg - 1) || \'\' %>"> <%- pg %> </a></li> <% }) %> <% if (\'count\' in meta) { %> <% if (hi + 1 < last_page) { %> <li class="page-item disabled"><a class="page-link" href="#">...</a></li> <% } %> <% if (hi < last_page || lo > hi) { %> <li class="page-item"><a class="page-link" href="?_offset=<%- meta.limit * (last_page - 1) %>"> <%- last_page %> </a></li> <% } %> <% } %> <li class="page-item <%- (last_page === null) || (page < last_page) ? \'\' : \'disabled\' %>"><a class="page-link" href="?_offset=<%- meta.offset + meta.limit %>">Next</a></li></ul>',template_size:'<% if (meta.limit) { %> <div class="btn-group btn-group-sm mr-2" role="group"><button id="formhandler-size-<%- idcount++ %>" type="button" class="btn btn-light btn-sm dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"> <%- meta.limit %> rows</button><div class="dropdown-menu" aria-labelledby="formhandler-size-<%- idcount %>"> <% _.each(options.sizeValues, function(size) { %> <a class="dropdown-item <%- meta.limit == size ? \'active\' : \'\' %> urlfilter" href="?_limit=<%- size %>"> <%- size %> </a> <% }) %> </div></div> <% } %>',template_count:"<% if ('count' in meta) { %> <span class=\"btn btn-sm btn-light mr-2\"> <%- meta.count %> rows</span> <% } %>",template_edit:'<button type="submit" class="btn btn-success mr-2 btn-sm edit-btn">Edit</button>',template_add:'<button type="button" class="btn btn-success mr-2 btn-sm add-btn">Add</button>',template_export:'<div class="btn-group btn-group-sm" role="group"><button id="formhandler-export-<%- idcount++ %>" type="button" class="btn btn-light btn-sm dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Export as</button><div class="dropdown-menu dropdown-menu-right" aria-labelledby="formhandler-export-<%- idcount %>"> <% _.each(options.exportFormats, function(label, key) { %> <a class="dropdown-item" href="<%- parse(options.src).update(args).update({_format: key}) %>"> <%- label %> </a> <% }) %> </div></div>',template_filters:'<div class="p-1"><%\n  var qparts = parse(\'?\')\n  _.each(args[\'_c\'], function(col_name) {\n    qparts.update({_c: col_name}, \'add\')\n    var hide_col = col_name[0] == \'-\'\n    var display_name = hide_col ? col_name.slice(1) : col_name %> <a href="?_c=<%- encodeURIComponent(col_name) %>" data-mode="del" class="badge badge-pill <%- hide_col ? \'badge-dark\' : \'badge-danger\' %> urlfilter" title="<%- hide_col ? \'Show\' : \'Hide\' %> column <%- display_name %>"> <%- display_name %> </a> <% })\n  _.each(args, function(list_values, key) {\n    if (key.charAt(0) !== \'_\' && key !== \'c\') {\n      _.each(args[key], function(col_name) {\n        var update = {}\n        update[key] = col_name\n        qparts.update(update, \'add\') %> <a href="?<%- encodeURIComponent(key) %>=<%- encodeURIComponent(col_name) %>" data-mode="del" class="badge badge-pill badge-dark urlfilter" title="Clear <%- key %> filter"> <%- key %> = <%- col_name %> </a> <% })\n    }\n  })\n  qparts = qparts.toString()\n  if (qparts && qparts != \'?\') { %> <a href="?<%- qparts.slice(1) %>" class="badge badge-pill badge-danger urlfilter" data-mode="del" title="Clear all filters">×</a> <% } %> </div>',template_error:'<div class="alert alert-warning alert-dismissible" role="alert"> <%- message %> <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">×</span></button></div>',template_table_grid:'<%\n  var filtered_cols = args[\'_c\'] && args[\'_c\'].length != options.columns.length ?\n                      options.columns.filter(function(col) { return args[\'_c\'].indexOf(\'-\' + col.name) < 0 }) :\n                      options.columns\n  var cols = options.columns.length ? filtered_cols : meta.columns\n  var form_id = idcount, img\n  if (options.rowTemplate) {\n    _.each(data, function(row, rowIndex) { %> <%= typeof options.rowTemplate == \'function\' ? options.rowTemplate({row: row, index: rowIndex, data: data}) : _.template(options.rowTemplate)({row: row, data: data, index: rowIndex}) %> <% })\n} else { %> <div class="formhandler-grid row"> <% _.each(data, function(row, rowIndex) { %> <div class="col-sm-3 <%= options.classes || \'formhandler-grid-cell d-inline-block p-3 box-shadow\' %>"><div class="thumbnail"> <% img = options.icon ? ((typeof(options.icon) == \'function\' ? options.icon({row: row, data: data, index: rowIndex}) : options.icon)) : \'fa fa-home\' %> <% if (img.indexOf(\'fa \') >= 0) { %> <i class="<%= img %>"></i> <% } else { %> <img class="img img-responsive" src="<%= img %>"> <% } %> <div class="caption"> <% _.each(cols, function(colinfo) {\n              var fmt = typeof(colinfo.format),\n                  val = row[colinfo.name],\n                  disp = (fmt == "function" ? colinfo.format({index: rowIndex, name: colinfo.name, value: val, row: row, data:data }) :\n                          fmt === "string" && colinfo.type === "number" ? numeral(val).format(colinfo.format) :\n                          fmt === "string" && colinfo.type === "date" ? moment.utc(val).format(colinfo.format) :\n                          val) %> <div><strong><%= colinfo.name %></strong>: <% if (\'link\' in colinfo) { %> <% var col_link = typeof colinfo.link == \'function\' ?\n                      colinfo.link({row: row, value: val, index: rowIndex, name: colinfo.name, data: data, format: disp}) :\n                      _.template(colinfo.link)({row: row, value: val, index: rowIndex, name: colinfo.name, data: data, format: disp}) %> <% if (col_link === false) { %> <%= disp %> <% } else if (col_link && col_link[0] == \'?\') { %> <a class="urlfilter" href="<%- col_link %>"><%= disp %></a> <% } else { %> <a href="<%- col_link %>" target="_blank"><%= disp %></a> <% } %> <% } else { %> <a class="urlfilter" href="?<%- encodeURIComponent(colinfo.name) %>=<%- encodeURIComponent(val) %>&_offset="> <%= disp %> </a> <% } %> </div> <% }) %> </div></div></div> <% }) %> </div> <% } %>'}),b=["href","protocol","origin","userinfo","username","password","hostname","port","relative","pathname","directory","file","search","hash"],y=["searchKey","searchList"],l=/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,r=/(?:^|&)([^&=]*)=?([^&]*)/g,s=function(e){return decodeURIComponent(e.replace(/\+/g,"%20"))},w=encodeURIComponent;function x(e){for(var t={toString:d,join:c,update:f},a=l.exec(e||""),n=14;n--;)t[b[n]]=a[n]||"";var o=t[y[0]]={},i=t[y[1]]={};return t[b[12]].replace(r,function(e,t,a){t&&(t=s(t),a=s(a),o[t]=a,i[t]=i[t]||[],i[t].push(a))}),t}function d(e){var t,a,n,o,i=(e=e||this)[b[1]]||"http",l=e[b[4]],r=e[b[5]],s=e[b[6]],d=e[b[7]],c=e[b[9]],f=e[b[12]],u=e[b[13]],m=e[y[0]],p=e[y[1]],h=s?[i,"://"]:[],v=[];if(l&&(h.push(l),r&&h.push(":",r),h.push("@")),h.push(s),d&&h.push(":",d),h.push(c||(s?"/":"")),f)h.push("?",f);else{if(p)for(t in p){for(n=0,o=(a=p[t]).length;n<o;n++)v.push(w(t)+"="+w(a[n]));o||v.push(t)}else if(m)for(t in m)v.push(w(t)+"="+w(m[t]));v.length&&h.push("?",v.join("&"))}return u&&h.push("#",u),h.join("")}function c(e,t){t=t||{};var a,n,o=this,i=o[b[9]].split("/"),l=i.length-1,r=x(e),s=r.pathname.split("/"),d=s.length;for(void 0===t.query&&(t.query=!0),void 0===t.hash&&(t.hash=!0),a=0;a<14;a++)9!=a&&(12!=a||t.query)&&(13!=a||t.hash)&&r[b[a]]&&(o[b[a]]=r[b[a]]);for(t.query&&r[b[12]]&&(o[y[0]]=r[y[0]],o[y[1]]=r[y[1]]),a=0;a<d;a++)"."==(n=s[a])?i[l]="":".."==n?i[--l]="":""===n?1<d&&(a||(i[0]=n,l=1),a==d-1&&(i[l]=n)):(i[l]=n,a<d-1&&l++);var c=o[b[9]]=i.slice(0,l+1).join("/"),f=c.split(/\//),u=[c];return o[b[12]]&&u.push("?",o[b[12]]),o[b[13]]&&u.push("#",o[b[13]]),o[b[8]]=u.join(""),o[b[10]]=f.slice(0,f.length-1).join("/")+"/",o[b[11]]=f[f.length-1],o}function f(e,t){var a,n,o,i,l,r,s,d=this[y[0]],c=this[y[1]],f=[],u={};if(t)if((t=""+t).match(/[&=]/))u=x("?"+t).searchKey;else for(a in e)u[a]=t;for(a in e){if(null===(n=e[a]))c[a]=[];else if(Array.isArray(n)||(n=[n]),u[a]){a in c||(c[a]=[]);for(l={},o=0,i=n.length;o<i;o++)l[n[o].toString()]=1;if((t=""+u[a]).match(/add/i))c[a]=c[a].concat(n);else if(t.match(/del/i)){for(s=[],o=0,i=(r=c[a]).length;o<i;o++)l[r[o]]||s.push(r[o]);c[a]=s}else if(t.match(/toggle/i)){for(s=[],o=0,i=(r=c[a]).length;o<i;o++)l[r[o]]?l[r[o]]=2:s.push(r[o]);for(n in l)1==l[n]&&s.push(n);c[a]=s}}else c[a]=n;0===c[a].length?(delete d[a],delete c[a]):d[a]=c[a][c[a].length-1]}for(a in c)for(o=0,i=(n=c[a]).length;o<i;o++)f.push(w(a)+"="+w(n[o]));return this.search=f.join("&"),this}function k(e,t){if(!t)return e;var a={};for(var n in e){var o=n.split(":");1==o.length?a[o[0]]=e[n]:o[0]===t&&(a[o[1]]=e[n])}return a}var h={null:{null:{state:"null"},date:{state:"date"},number:{state:"number"},boolean:{state:"boolean"},string:{state:"string"},object:{state:"object"},mixed:{state:"mixed",end:!0}},date:{null:{state:"date"},undefined:{state:"date"},date:{state:"date"},default:{state:"mixed",end:!0}},number:{null:{state:"number"},undefined:{state:"number"},number:{state:"number"},default:{state:"mixed",end:!0}},boolean:{null:{state:"boolean"},undefined:{state:"boolean"},boolean:{state:"boolean"},default:{state:"mixed",end:!0}},string:{null:{state:"string"},undefined:{state:"string"},string:{state:"string"},default:{state:"mixed",end:!0}},object:{null:{state:"object"},object:{state:"object"},undefined:{state:"object"},default:{state:"mixed",end:!0}},mixed:{default:{state:"mixed",end:!0}}};function a(e,t,a){return e?-1!=e.indexOf(t)?!a:a:a?null==t:null!=t}function n(e,t,a){return isNaN(t)&&Date.parse(t)&&(t=Date.parse(t)),isNaN(e)&&Date.parse(e)&&(e=Date.parse(e)),a?e<=t:e<t}var p={"=":function(e,t){return a(e,t,!1)},"!":function(e,t){return a(e,t,!0)},">":function(e,t){return n(e,t,!1)},"<":function(e,t){return n(t,e,!1)},">~":function(e,t){return n(e,t,!0)},"<~":function(e,t){return n(t,e,!0)},"~":function(e,t){return a(t,e[0],!1)},"!~":function(e,t){return a(t,e[0],!0)}},v={string:function(e,t,a){return a||(a="asc"),"desc"==a&&(e=[t,t=e][0]),e.localeCompare(t)},number:function(e,t,a){return a||(a="asc"),"desc"==a&&(e=[t,t=e][0]),e-t}};function u(e,t,a){var n,o,i=e;t=k(t=t||[],a);var l=function(e,t){var a={};if(!e||!e.length)return a;(t=t||{}).convert=t.convert||!1,t.limit=t.limit||1e3;for(var n=t.limit<e.length?t.limit:e.length,o=t.ignore=t.ignore||[null,void 0],i=Object.keys(e[0]),l=0;l<i.length;l++){for(var r=i[l],s="null",d=0;d<n;d++){var c=e[d],f=c[r];if(0==l&&Object.keys(e[d]).forEach(function(e){-1==i.indexOf(e)&&i.push(e)}),r in c&&!(0<=o.indexOf(f))){var u=typeof f;null==f?u="null":"object"!=u||isNaN(Date.parse(f))?t.convert&&(!isNaN(parseFloat(f))&&isFinite(f)||0<=["NaN","Infinity","-Infinity"].indexOf(f)?u="number":isNaN(Date.parse(f))?-1!=["true","false"].indexOf(f)&&(u="boolean"):u="date"):u="date";var m=h[u],p=m[s]||m.default;if(s=p.state,p.end)break}}a[r]=s}return a}(e,{convert:!0});for(var r in t)if("_"!=r[0]){var s=r.match(/(!|>|>~|<|<~|~|!~)$/)?r.match(/(!|>|>~|<|<~|~|!~)$/).index:r.length;n=""!=r.slice(s)?r.slice(s):"=",o=""!=t[r][0]?t[r]:null;var d=r.slice(0,s);"number"==l[d]?o=o.map(function(e){return parseFloat(e)}):"boolean"==l[d]?o=o.map(function(e){return"true"==String(e)}):"date"==l[d]&&(o=o.map(function(e){return Date.parse(e)})),i=i.filter(function(e){return void 0===e[d]||p[n](o,e[d])})}var c=parseInt(t._offset)||0,f=parseInt(t._limit)||1e3;if(i=i.slice(c,c+f),t._c){var u=[],m=[];t._c.forEach(function(e){"-"==e[0]?u.push(e.slice(1)):m.push(e)}),i=i.map(function(e){return function(t,e,a){0==e.length&&(e=Object.keys(t));var n={};return e.forEach(function(e){a.indexOf(e)<0&&(n[e]=t[e])}),n}(e,m,u)})}return t._sort&&i.sort(function(n,o){var i=!1;return t._sort.forEach(function(e){var t="-"==e[0]?"desc":"asc";if("-"==e[0]&&(e=e.substr(1)),void 0!==n[e]){var a=isNaN(n[e])?"string":"number";i=i||v[a](n[e],o[e],t)}}),i}),i}var j=["","table","edit","add","page","size","count","export","filters","error","table_grid"],m={table:!0,edit:!1,add:!1,page:!0,pageSize:100,size:!0,sizeValues:[10,20,50,100,500,1e3],count:!0,export:!0,exportFormats:{xlsx:"Excel",csv:"CSV",json:"JSON",html:"HTML"},filters:!0,onhashchange:!0},E=["filters","ignored","excluded","sort","offset","limit","count"],t={text:{"":"Equals...","!":"Does not equal...","~":"Contains...","!~":"Does not contain..."},number:{"":"Equals...","!":"Does not equal...","<":"Less than...",">":"Greater than..."},date:{"":"Equals...","!":"Does not equal...","<":"Before...",">":"After..."}};function C(e){"sort"in e&&!0!==e.sort?"object"!=typeof e.sort&&(e.sort={}):e.sort={"":"Sort ascending","-":"Sort descending"},e.type=e.type||"text","filters"in e&&!0!==e.filters||(e.filters=t[e.type]),"hideable"in e||(e.hideable=!0),"hide"in e||(e.hide=!1)}function I(e,t,a,n,o){if(!e||a[e]){var i;if(e){"grid"==a[e]&&(e="table_grid");var l=a[e+"Target"]||"."+e;0==(i=$(l,n)).length&&(i=$(l))}else i=n;i.html(o[e](t))}}function q(e,t,a){var n=$(".note",e);n.length||(n=$('<div class="note"></div>').appendTo(e)),n.html(t.error({message:a}))}function S(e,t,a,n,o){var i=n+": "+o;0==a.readyState&&(i+=" (cannot connect to server)"),q(e,t,i)}function N(e,t){$("tbody :input",e).on("change",function(){$(this).parents("tr").addClass("edited-row")}).on("keypress",function(e){13==e.keyCode&&($(this).blur(),t.trigger("click"))}).eq(0).focus()}function T(e,t,a){var n=e.data(t);return void 0===n||!1===n||null===n?a:"string"!=typeof n||!n.match(/^(false|off|n|no)$/i)}var o={attr:"href",event:"click change submit",selector:".urlfilter",src:"src"},i=".urlfilter";var O={parse:x,unparse:d,join:c,update:f};"undefined"!=typeof jQuery&&jQuery.extend(jQuery.fn,{urlfilter:function(e){if(0!=this.length){var t=this[0].ownerDocument,u=$.extend({},o,e||{},this.dataset),m=u.remove||T(this,"remove"),a=u.event.split(/\s+/).map(function(e){return e+i}).join(" "),p=u.location||(t.defaultView||t.parentWindow).location,h=u.history||(t.defaultView||t.parentWindow).history;return this.on(a,u.selector,function(e){var o,t=$(this),i=t.data("mode")||u.mode,a=t.data("target")||u.target,n=t.data("src")||u.src,l=T(t,"remove",m);if("change"==e.type||$(e.target).is(":input:not(:button)")){var r=encodeURIComponent(t.attr("id")||t.attr("name")),s=encodeURIComponent(t.val());o="?"+r+"="+s}else if("submit"==e.type||$(e.target).is("form"))e.preventDefault(),o="?"+t.serialize();else{if("click"!=e.type)return;$(e.target).is("a")&&e.preventDefault(),o=t.attr(u.attr)}var d=x(o),c=d.searchList;function f(e){var t=x(e).join(o,{query:!1,hash:!1}).update(c,i);if(l){var a={};for(var n in t.searchKey)""===t.searchKey[n]&&(a[n]=null);t.update(a)}return t.toString()}a?"#"==a?p.hash=f(p.hash.replace(/^#/,"")):a.match(/^pushstate$/i)?h.pushState({},"",f(p.href)):$(a).each(function(){var e=$(this),t=f(e.attr(n));e.attr(n,t).load(t,function(){e.trigger({type:"load",url:t})})}):p.href=f(p.href),t.trigger({type:"urlfilter",url:d})})}}}),"undefined"!=typeof jQuery&&jQuery.extend(jQuery.fn,{formhandler:function(t){return t||(t={}),this.each(function(){var p=$(this);p.urlfilter({selector:".urlfilter, .page-link",target:"#",remove:!0});var h=$.extend({},m,t,p.data());h.columns?"string"==typeof h.columns&&(h.columns=_.map(h.columns.split(/\s*,\s*/),function(e){return{name:e}})):h.columns=[];var l,o,i,r,s,v={};function d(e,t,a){a.rows=e.length,a.columns=e.length?_.map(e[0],function(e,t){return{name:t}}):[];var n=_.find(h.columns,function(e){return"*"===e.name});if(n){var o=_.cloneDeep(a.columns);_.map(h.columns,function(t){_.find(a.columns,function(e){return e.name===t.name})||"*"===t.name||o.push(t)}),o=_.map(o,function(t){var e=_.find(h.columns,function(e){return e.name===t.name});return e||$.extend({},n,t)})}h.columns=o||h.columns;var i,l,r,s,d,c,f,u,m={data:e,meta:a,args:t,options:h,idcount:0,parse:x,col_defaults:C,isEdit:!1,isAdd:!1,templates:g};p.data("formhandler",m),_.each(j,function(e){I(e,m,h,p,v)}),h.add&&(i=p,l=m,r=h,s=v,$(".add button",i).on("click",function(){var e=$(".add button",i),t=$(".edit button",i);if("save"==e.html().toLowerCase()){e.html("Add"),t.prop("disabled",!1);var a=$(".new-row td[data-key]");$(".loader",i).removeClass("d-none");var n={};if($.each(a,function(e,t){n[t.getAttribute("data-key")]=$(t).children().val()}),!_.some(n))return $(".loader",i).addClass("d-none"),l.isAdd=!1,void I("table",l,r,i,s);$.ajax(r.src,{method:"POST",dataType:"json",data:n}).done(function(){l.data.unshift(n),l.isAdd=!1,I("table",l,r,i,s),r.add.done&&r.add.done()}).always(function(){$(".loader",i).addClass("d-none")}).fail(S.bind(this,i,s))}else"add"==e.html().toLowerCase()&&(e.html("Save"),t.prop("disabled",!0),l.isAdd=!0,I("table",l,r,i,s),N(i,e))})),h.edit&&(d=p,c=m,f=h,u=v,$(".edit button",d).on("click",function(){var e=$(".edit button",d),t=$(".add button",d);if("save"==e.html().toLowerCase()){var a=$(".edited-row");0<a.length&&$(".loader",d).removeClass("d-none");var i=[],l=!0;if($.each(a,function(e,t){var a,n=JSON.parse(t.getAttribute("data-val")),o=t.getAttribute("data-row");for(e in n)$('td[data-key="'+(a=e,a.toString().replace(/["']/g,""))+'"] :input',t).each(function(){this.checkValidity()?($(this).removeClass("is-invalid"),n[e]=c.data[o][e]=$(this).val()):($(this).addClass("is-invalid"),l=!1)});i.push($.ajax(f.src,{method:"PUT",dataType:"json",data:n}).fail(S.bind(this,d,u)).always(function(){$(".loader",d).addClass("d-none"),f.add.editFunction&&f.add.editFunction()}))}),!l)return;$.when.apply($,i).then(function(){$(".loader",d).addClass("d-none"),e.html("Edit"),t.prop("disabled",!1),f.edit.done&&f.edit.done()}),c.isEdit=!1,I("table",c,f,d,u)}else"edit"==e.html().toLowerCase()&&(e.html("Save"),t.prop("disabled",!0),c.isEdit=!0,I("table",c,f,d,u),N(d,e),d.trigger({type:"editmode"}))}))}function e(){var e=x(location.hash.replace(/^#/,"")).searchList;e=k(e,h.name);var i=_.extend({c:h.columns.map(function(e){return e.name}),_limit:h.pageSize,_format:"json",_meta:"y"},e);function t(e,t,a){var n={};if(_.each(E,function(e){var t=a?a.getResponseHeader("Fh-Data-"+e):null;null!==t&&(n[e]=JSON.parse(t))}),"function"==typeof h.transform){var o=h.transform({data:e,meta:n,options:h,args:i})||{};e="data"in o?o.data:e,n="meta"in o?o.meta:n}_.isEmpty(n)&&h.page&&h.size&&(n.offset=i._offset?parseInt(i._offset):0,n.limit=parseInt(i._limit),n.count=e.length,e=u(e,i)),d(e,i,n),p.trigger({type:"load",formdata:e,meta:n,args:i,options:h})}$(".loader",p).removeClass("d-none"),h.data&&"object"==typeof h.data?(h.edit=!1,h.add=!1,t(h.data)):$.ajax(h.src,{dataType:"json",data:i,traditional:!0}).done(t).always(function(){$(".loader",p).addClass("d-none")}).fail(S.bind(this,p,v))}_.each(j,function(e){var t=h[e?e+"Template":"template"]||g["template_"+e]||"NA";v[e]=_.template(t)}),(l=p).on("shown.bs.modal",".formhandler-table-modal",function(e){var t=$(e.relatedTarget),a=l.data("formhandler"),n=t.data("op"),o=t.closest("[data-col]").data("col"),i="";a.args[o+n]?(i=a.args[o+n].join(","),$(".remove-action",this).attr("href","?"+o+n+"=").show()):$(".remove-action",this).hide(),$("input",this).val(i).attr("name",o+n).focus(),$("label",this).text(t.text())}).on("submit","form",function(e){e.preventDefault();var t=x("?"+$(this).serialize()).searchKey;$(this).closest(".formhandler-table-modal").modal("hide"),window.location.hash="#"+x(location.hash.replace(/^#/,"")).update(t)}),i=h,r=v,s={delete:function(e){return $.ajax(i.src,{method:"DELETE",dataType:"json",data:e.row}).done(function(){$('tr[data-row="'+e.index+'"]',o).remove()})}},(o=p).on("click","[data-action]",function(){var e={row:$(this).closest("[data-val]").data("val"),index:$(this).closest("[data-row]").data("row"),notify:q.bind(this,o,r)},t=$(this).data("action"),a=i.actions&&0<i.actions.filter(function(e){return t in e}).length?i.actions.filter(function(e){return t in e})[0][t]:s[t],n=a(e);n&&n.always&&($(".loader",o).removeClass("d-none"),n.always(function(){$(".loader",o).addClass("d-none")}).fail(S.bind(this,o,r)))}),h.onhashchange&&$(window).on("hashchange",e),e()}),this}}),e.version="0.16.2",e.url=O,Object.defineProperty(e,"__esModule",{value:!0})});
