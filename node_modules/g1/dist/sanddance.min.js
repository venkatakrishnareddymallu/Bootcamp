!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n(t.g1=t.g1||{})}(this,function(t){"use strict";var n;function e(o,s){return function(t){var n,r,e,a="function"==typeof s.metric?s.metric:function(t){return t[s.metric]};s.scheme&&0!==(e=s.scheme).lastIndexOf("scheme",0)&&(e="interpolate"+e),r=s.scale?s.scale.replace(/\w+/g,function(t){return t[0].toUpperCase()+t.slice(1).toLowerCase()}):e?"Sequential":"Linear";var i=s.domain||d3.extent(o,a);return e?n=d3["scale"+r](d3[e]).domain(i):s.range&&(n=d3["scale"+r]().domain(i).range(s.range)),n(a(t))}}var f=180/Math.PI,r={translateX:0,translateY:0};function y(t){return null==t?r:(n||(n=document.createElementNS("http://www.w3.org/2000/svg","g")),n.setAttribute("transform",t),(t=n.transform.baseVal.consolidate())?function(t,n,r,e,a,i){var o,s,u;(o=Math.sqrt(t*t+n*n))&&(t/=o,n/=o);(u=t*r+n*e)&&(r-=t*u,e-=n*u);(s=Math.sqrt(r*r+e*e))&&(r/=s,e/=s,u/=s);t*e<n*r&&(t=-t,n=-n,u=-u,o=-o);return{translateX:a,translateY:i,rotate:Math.atan2(n,t)*f,skewX:Math.atan(u)*f,scaleX:o,scaleY:s}}((t=t.matrix).a,t.b,t.c,t.d,t.e,t.f):r)}function u(t,n,r){return n in t&&(r=t[n],delete t[n]),r}function a(t){for(var n=1,r=arguments.length;n<r;n++){var e=arguments[n];for(var a in e)t[a]=e[a]}return t}function g(t,r,n){var e=t.map(function(t,n){return n});if(r){var a=t.map("function"==typeof r?function(t,n){return[r(t),n]}:function(t,n){return[t[r],n]});e.sort(function(t,n){var r=a[t][0],e=a[n][0];return r<e?-1:e<r?1:a[t][1]-a[n][1]}),n=!n&&void 0!==n;for(var i=0,o=e.length,s=[];i<o;i++)s[e[i]]=n?i:o-i-1;e=s}return e}function M(t,n){for(var r in n)"object"==typeof n[r]&&(n[r]=e(t,n[r]));return n}var i=".sanddance",o={grid:function(t,n){var r=n.data,e=n.width,a=n.height,i=e*a/r.length,o=Math.sqrt(i),s=Math.ceil(e/o),u=Math.ceil(r.length/s),f=o*u,c=n.filter,d=g(r=c?r.filter(function(t,n){return c(t,n)}):r,n.sort,n.ascending);return t.transform=function(t,n){var r=(n=d[n])%s,e=Math.floor(n/s);return"translate("+(this.dataset._sd_x=r*o)+","+(this.dataset._sd_y=f-(e+1)*o)+")"},{attrs:M(r,t),options:n}},hexpack:function(t,n){var r,e=n.data,a=n.filter,i=g(e=a?e.filter(function(t,n){return a(t,n)}):e,n.sort,n.sort_ascending),o=e.length,s=[[0,0]],u=1,f=0;for(;f<o;){for(r=0;1-u<=r;r--)s.push([u,r]);for(r=u;1<=r;r--)s.push([r,-u]);for(r=0;1-u<=r;r--)s.push([r,-u-r]);for(r=0;r<=u-1;r++)s.push([-u,r]);for(r=-u;r<=-1;r++)s.push([r,u]);for(r=0;r<=u-1;r++)s.push([r,u-r]);f+=6*u,u++}var c=n.width,d=n.height,l=2*u-1,h=c/l,p=d/l,v=h*Math.cos(60*Math.PI/180),m=p*Math.sin(60*Math.PI/180);return s=s.slice(0,o).map(function(t){return[t[0]*h+t[1]*v+c/2,t[1]*m+d/2]}),t.transform=function(t,n){n=i[n];var r=s[n];return"translate("+r[0]+","+r[1]+")"},{attrs:M(e,t),options:n}},spiral:function(t,n){var r=n.data,e=n.filter,a=g(r=e?r.filter(function(t,n){return e(t,n)}):r,n.sort,n.sort_ascending),i=u(n,"spiral_size"),o=u(n,"spiral_angle")*Math.PI/180,s=r.map(function(t,n){return[n*i*Math.cos(n*o),n*i*Math.sin(n*o)]});return t.transform=function(t,n){return n=a[n],"translate("+s[n][0]+","+s[n][1]+")"},{attrs:M(r,t),options:n}}};function s(u,f){f=f||{};var t,c=d3.dispatch("init","start","end");f.layout&&(t=o[f.layout](u,f),u=t.attrs,f=t.options);var d=f.duration,l=f.speed,h=f.delay||0,p=f.easing||d3.easeLinear,v=f.filter,m=f.x,g=f.y,r=function(t){c.call("init",t);var n=v?t.filter(v):t,r=n.transition().ease(p);if(m||g){var a="function"==typeof m?m:function(){return m},i="function"==typeof g?g:function(){return g};r.attr("transform",function(t,n){var r=a(t,n),e=i(t,n);return"translate("+(this.dataset._sd_x=r)+","+(this.dataset._sd_y=e)+")"})}for(var e in u)r=r.attr(e,u[e]);"duration"in f?r=r.duration(d):l&&(r=r.duration(function(t){var n,r,e=y(this.getAttribute("transform")),a=e.translateX,i=e.translateY,o=this.dataset._sd_x,s=this.dataset._sd_y;return(n=o-a,r=s-i,Math.sqrt(n*n+r*r))/("function"==typeof l?l(t):l)*1e3})),h&&(r=r.delay(function(t){return"function"==typeof h?h(t):h}));var o=n.size(),s=0;r.on("start.count",function(){0===s&&c.call("start",t),s++}),r.on("end interrupt",function(){if(!(0<--o)){if(0===o)return c.call("end",t);throw new function(t,n){this.message=t,this.options=n}("sanddance: Invalid count: "+o,f)}})};return r.on=function(t,n){return c.on(t+i,n),r},r.update=function(t,n){return s(a({},u,t),a({},f,n))},r}s.chain=function(){for(var t=0,n=arguments.length-1;t<n;t++)!function(t,n){t.on("end"+i,function(){this.call(n)})}(arguments[t],arguments[t+1]);return arguments[0]},t.version="0.16.2",t.sanddance=s,Object.defineProperty(t,"__esModule",{value:!0})});
